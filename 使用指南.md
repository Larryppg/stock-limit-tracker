# Aè‚¡è¿æ¿é«˜åº¦è¿½è¸ªç³»ç»Ÿ - ä½¿ç”¨æŒ‡å—

## ğŸ“¦ å®‰è£…ä¸é…ç½®

### 1. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

### 2. é…ç½®è¯´æ˜

ä¸»è¦é…ç½®åœ¨ `config.py` ä¸­ï¼š

- `DB_PATH`: æ•°æ®åº“è·¯å¾„ï¼ˆé»˜è®¤: `data/stock_limit.db`ï¼‰
- `HISTORY_START_DATE`: å†å²æ•°æ®èµ·å§‹æ—¥æœŸï¼ˆé»˜è®¤: 20200101ï¼‰
- `DEFAULT_RECENT_DAYS`: MVPæ¨¡å¼é»˜è®¤å¤©æ•°ï¼ˆé»˜è®¤: 90å¤©ï¼‰
- `LIMIT_RATIO`: å„æ¿å—æ¶¨è·Œå¹…é™åˆ¶
- `DAILY_UPDATE_TIME`: æ¯æ—¥æ›´æ–°æ—¶é—´ï¼ˆé»˜è®¤: 16:00ï¼‰

## ğŸš€ å¿«é€Ÿå¼€å§‹

### MVPæ¨¡å¼ï¼ˆæ¨èé¦–æ¬¡ä½¿ç”¨ï¼‰

å¿«é€ŸéªŒè¯ç³»ç»ŸåŠŸèƒ½ï¼Œåªå¤„ç†å‰50åªè‚¡ç¥¨çš„æœ€è¿‘90å¤©æ•°æ®ï¼š

```bash
python main.py --mode mvp --days 90
```

**é¢„è®¡è€—æ—¶**: 5-10åˆ†é’Ÿ

### æµ‹è¯•ç®—æ³•

æµ‹è¯•è¿æ¿è®¡ç®—æ ¸å¿ƒç®—æ³•ï¼š

```bash
python main.py --mode test
```

### éªŒè¯ç»“æœ

è¿è¡ŒMVPåï¼ŒéªŒè¯è®¡ç®—ç»“æœçš„å‡†ç¡®æ€§ï¼š

```bash
python verify_results.py
```

è¯¥è„šæœ¬ä¼šï¼š
- æŠ½æ ·æ ¸å¯¹è¿æ¿è®¡ç®—
- æ£€æŸ¥æ•°æ®è´¨é‡
- å¯¼å‡ºæ ·æœ¬æ•°æ®ï¼ˆ`sample_results.csv`ï¼‰

## ğŸ“Š æ•°æ®æŸ¥è¯¢

### æ–¹å¼1: Python API

```python
from query_api import LimitQueryAPI

api = LimitQueryAPI()
api.connect()

# æŸ¥è¯¢æŸæ—¥é«˜è¿æ¿è‚¡ç¥¨
high_chain = api.query_high_chain_stocks('20240115', min_height=3)
print(high_chain)

# æŸ¥è¯¢è‚¡ç¥¨å†å²æœ€é«˜è¿æ¿
max_chain = api.query_stock_max_chain('300059')
print(f"æœ€é«˜è¿æ¿: {max_chain['max_chain']}æ¿")

# æŸ¥è¯¢å¸‚åœºæ‘˜è¦
summary = api.query_daily_summary('20240115')
print(f"æ¶¨åœæ€»æ•°: {summary['total_limit']}")

api.close()
```

### æ–¹å¼2: SQLç›´æ¥æŸ¥è¯¢

```bash
# ä½¿ç”¨SQLiteå‘½ä»¤è¡Œ
sqlite3 data/stock_limit.db

# æˆ–ä½¿ç”¨Python
python -c "import sqlite3; conn = sqlite3.connect('data/stock_limit.db')"
```

**å¸¸ç”¨æŸ¥è¯¢ç¤ºä¾‹**:

```sql
-- æŸ¥è¯¢2024å¹´1æœˆ15æ—¥æ‰€æœ‰3æ¿ä»¥ä¸Šçš„è‚¡ç¥¨
SELECT l.code, s.name, l.chain_height 
FROM limit_analysis_result l
LEFT JOIN stock_meta s ON l.code = s.code
WHERE l.date = '20240115' AND l.chain_height >= 3
ORDER BY l.chain_height DESC;

-- ç»Ÿè®¡æŸè‚¡ç¥¨å†å²æœ€é«˜è¿æ¿
SELECT MAX(chain_height) as max_chain
FROM limit_analysis_result
WHERE code = '300059';

-- æŸ¥è¯¢æŸæ—¥æ¶¨åœæ¿ç»Ÿè®¡
SELECT 
    COUNT(*) as total,
    SUM(CASE WHEN board_type = 'yizi' THEN 1 ELSE 0 END) as yizi,
    SUM(CASE WHEN is_fried = 1 THEN 1 ELSE 0 END) as fried
FROM limit_analysis_result
WHERE date = '20240115' AND limit_status = 1;
```

### æ–¹å¼3: Webå¯è§†åŒ–ç•Œé¢

å¯åŠ¨Streamlitå¯è§†åŒ–ç•Œé¢ï¼š

```bash
streamlit run web_interface.py
```

ç•Œé¢åŠŸèƒ½ï¼š
- ğŸ“ˆ å¸‚åœºæ¦‚è§ˆï¼ˆæ¶¨åœæ•°é‡ã€è¿æ¿åˆ†å¸ƒï¼‰
- ğŸ” é«˜è¿æ¿æŸ¥è¯¢ï¼ˆæŒ‰æ—¥æœŸã€è¿æ¿é«˜åº¦ç­›é€‰ï¼‰
- ğŸ“Š ä¸ªè‚¡åˆ†æï¼ˆæŸ¥è¯¢ä¸ªè‚¡è¿æ¿å†å²ï¼‰
- ğŸ“‰ å†å²ç»Ÿè®¡ï¼ˆè¶‹åŠ¿åˆ†æã€æ’è¡Œæ¦œï¼‰

## ğŸ”„ å…¨é‡å†å²å›å¡«

### æ–¹å¼1: ä½¿ç”¨main.py

```bash
# å›å¡«2020å¹´è‡³ä»Šçš„å…¨é‡æ•°æ®
python main.py --mode backfill

# æŒ‡å®šæ—¥æœŸèŒƒå›´
python main.py --mode backfill --start-date 20220101 --end-date 20231231
```

**æ³¨æ„**: 
- å…¨é‡å›å¡«å¯èƒ½éœ€è¦2-4å°æ—¶
- ä¼šè‡ªåŠ¨åˆ†æ‰¹å¤„ç†ï¼Œé¿å…å†…å­˜æº¢å‡º
- æ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼ˆä¸­æ–­åå¯æ¢å¤ï¼‰

### æ–¹å¼2: ä½¿ç”¨BackfillManager

```python
from backfill_manager import BackfillManager

# åˆ›å»ºå›å¡«ä»»åŠ¡
manager = BackfillManager('20200101', '20231231', batch_size=50)
manager.run()
```

### æ¢å¤ä¸­æ–­çš„ä»»åŠ¡

```python
from backfill_manager import resume_interrupted_task

# æŸ¥çœ‹æ•°æ®åº“ä¸­çš„task_idï¼Œç„¶åæ¢å¤
resume_interrupted_task('backfill_20200101_20231231_abc123')
```

## â° æ¯æ—¥è‡ªåŠ¨æ›´æ–°

### æ–¹å¼1: æ‰‹åŠ¨æ‰§è¡Œ

```bash
# æ›´æ–°ä»Šå¤©çš„æ•°æ®
python main.py --mode daily

# æ›´æ–°æŒ‡å®šæ—¥æœŸ
python main.py --mode daily --date 20240115
```

### æ–¹å¼2: å¯åŠ¨å®šæ—¶è°ƒåº¦å™¨

```bash
# å¯åŠ¨è°ƒåº¦å™¨ï¼ˆæ¯ä¸ªäº¤æ˜“æ—¥16:00è‡ªåŠ¨æ›´æ–°ï¼‰
python scheduler.py --mode start
```

è°ƒåº¦å™¨ä¼šï¼š
- æ¯ä¸ªå·¥ä½œæ—¥16:00è‡ªåŠ¨æ‰§è¡Œ
- è‡ªåŠ¨è·å–å½“æ—¥æ•°æ®å¹¶è®¡ç®—è¿æ¿
- å†™å…¥æ—¥å¿—æ–‡ä»¶ `scheduler.log`
- æŒ‰ Ctrl+C åœæ­¢

### æ–¹å¼3: ç³»ç»Ÿçº§å®šæ—¶ä»»åŠ¡

**Windows (ä»»åŠ¡è®¡åˆ’ç¨‹åº)**:

1. æ‰“å¼€"ä»»åŠ¡è®¡åˆ’ç¨‹åº"
2. åˆ›å»ºåŸºæœ¬ä»»åŠ¡
3. è§¦å‘å™¨: æ¯æ—¥ 16:00
4. æ“ä½œ: å¯åŠ¨ç¨‹åº
5. ç¨‹åº: `python`
6. å‚æ•°: `C:\path\to\main.py --mode daily`

**Linux/Mac (crontab)**:

```bash
# ç¼–è¾‘crontab
crontab -e

# æ·»åŠ å®šæ—¶ä»»åŠ¡ï¼ˆæ¯å¤©16:00æ‰§è¡Œï¼‰
0 16 * * 1-5 cd /path/to/project && python main.py --mode daily
```

## ğŸ“ æ•°æ®æ–‡ä»¶è¯´æ˜

### æ•°æ®åº“ä½ç½®

```
data/
â””â”€â”€ stock_limit.db  # SQLiteæ•°æ®åº“
```

### æ•°æ®åº“è¡¨ç»“æ„

**stock_meta** - è‚¡ç¥¨å…ƒä¿¡æ¯
- code: è‚¡ç¥¨ä»£ç 
- name: è‚¡ç¥¨åç§°
- board_type: æ¿å—ï¼ˆMAIN/GEM/STAR/BJï¼‰
- limit_ratio: æ¶¨è·Œå¹…é™åˆ¶
- is_st: æ˜¯å¦STè‚¡ç¥¨

**daily_market_data** - æ—¥çº¿è¡Œæƒ…
- date: äº¤æ˜“æ—¥æœŸ
- code: è‚¡ç¥¨ä»£ç 
- open/high/low/close: OHLC
- pre_close: å‰æ”¶ç›˜ä»·
- volume/amount: æˆäº¤é‡/æˆäº¤é¢

**limit_analysis_result** - æ¶¨åœåˆ†æ
- date: äº¤æ˜“æ—¥æœŸ
- code: è‚¡ç¥¨ä»£ç 
- limit_status: æ¶¨åœçŠ¶æ€ï¼ˆ0/1ï¼‰
- chain_height: è¿æ¿é«˜åº¦
- is_fried: æ˜¯å¦ç‚¸æ¿
- board_type: æ¿å‹ï¼ˆyizi/normal/friedï¼‰

**fetch_progress** - ä»»åŠ¡è¿›åº¦
- task_id: ä»»åŠ¡ID
- start_date/end_date: æ—¥æœŸèŒƒå›´
- status: çŠ¶æ€ï¼ˆpending/running/completed/failedï¼‰

## ğŸ”§ å¸¸è§é—®é¢˜

### Q1: è·å–æ•°æ®æ—¶æç¤ºé™æµæ€ä¹ˆåŠï¼Ÿ

A: è°ƒæ•´ `config.py` ä¸­çš„ `FETCH_SLEEP_INTERVAL`ï¼Œå¢åŠ è¯·æ±‚é—´éš”ï¼ˆå¦‚æ”¹ä¸º1ç§’ï¼‰ã€‚

### Q2: æ•°æ®åº“æ–‡ä»¶åœ¨å“ªé‡Œï¼Ÿ

A: é»˜è®¤åœ¨ `data/stock_limit.db`ï¼Œå¯é€šè¿‡ `config.DB_PATH` ä¿®æ”¹ã€‚

### Q3: å¦‚ä½•æ¸…ç©ºæ•°æ®åº“é‡æ–°å¼€å§‹ï¼Ÿ

A: åˆ é™¤ `data/stock_limit.db` æ–‡ä»¶ï¼Œç„¶åé‡æ–°è¿è¡ŒMVPæˆ–å›å¡«ã€‚

### Q4: MVPæ¨¡å¼åªå¤„ç†50åªè‚¡ç¥¨å¤Ÿå—ï¼Ÿ

A: MVPæ¨¡å¼ç”¨äºå¿«é€ŸéªŒè¯ï¼Œç”Ÿäº§ä½¿ç”¨è¯·è¿è¡Œå…¨é‡å›å¡«ã€‚

### Q5: å¤æƒå¦‚ä½•å¤„ç†ï¼Ÿ

A: é»˜è®¤ä¸å¤æƒï¼ˆ`adjust=''`ï¼‰ï¼Œé¿å…å†å²æ¶¨åœä»·å¤±çœŸã€‚å¯åœ¨ `data_fetcher.py` ä¿®æ”¹ã€‚

### Q6: å¦‚ä½•å¯¼å‡ºæ•°æ®ï¼Ÿ

A: 
- ä½¿ç”¨ `verify_results.py` å¯¼å‡ºæ ·æœ¬æ•°æ®
- ä½¿ç”¨Webç•Œé¢çš„ä¸‹è½½åŠŸèƒ½
- ç›´æ¥ä½¿ç”¨SQLå¯¼å‡ºCSV

```python
import pandas as pd
import sqlite3

conn = sqlite3.connect('data/stock_limit.db')
df = pd.read_sql_query("SELECT * FROM limit_analysis_result", conn)
df.to_csv('export.csv', index=False, encoding='utf-8-sig')
conn.close()
```

## ğŸ“ˆ è¿›é˜¶ä½¿ç”¨

### è‡ªå®šä¹‰æ¶¨è·Œå¹…è§„åˆ™

ç¼–è¾‘ `config.py`:

```python
LIMIT_RATIO = {
    'MAIN': 0.10,    # ä¸»æ¿Â±10%
    'GEM': 0.20,     # åˆ›ä¸šæ¿Â±20%
    'STAR': 0.20,    # ç§‘åˆ›æ¿Â±20%
    'BJ': 0.30,      # åŒ—äº¤æ‰€Â±30%
    'ST': 0.05,      # STè‚¡ç¥¨Â±5%
}
```

### ä¿®æ”¹æ¶¨åœåˆ¤å®šå®¹å·®

```python
LIMIT_TOLERANCE = 0.001  # 0.1%è¯¯å·®
```

### æ‰¹é‡å¤„ç†å¤§å°

```python
FETCH_BATCH_SIZE = 100  # æ¯æ‰¹æ¬¡è‚¡ç¥¨æ•°é‡
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. ä¾èµ–æ˜¯å¦æ­£ç¡®å®‰è£…
2. AkShareæ˜¯å¦èƒ½æ­£å¸¸è®¿é—®
3. æ•°æ®åº“æ–‡ä»¶æƒé™
4. æ—¥å¿—æ–‡ä»¶ï¼ˆ`scheduler.log`ï¼‰

## ğŸ“„ è®¸å¯è¯

MIT License
